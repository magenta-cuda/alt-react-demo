<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>SV Bootstrap Front End</title>
  </head>
  <body>
      
<div class="tab-content" id="pills-tabContent" style="width: 225px; height:225px; border: 3px solid red; box-sizing: border-box;">
  <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">HOME</div>
  <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">PROFILE</div>
  <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">CONTACT</div>
</div>
      
      <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist" style="display: grid; grid: auto-flow / repeat(3, 1fr); width: 225px; border: 3px solid blue; box-sizing: border-box; overflow: hidden;">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">Home</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Profile</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Contact</button>
  </li>
</ul>

    <div id="tab-root"></div>
    <div id="nav-root"></div>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
        function createTabPane(data) {
            return jQuery(`
<div class="tab-pane fade" id="pills-${data.target}" role="tabpanel" aria-labelledby="pills-${data.target}-tab">
The content of ${data.content}.
</div>
`                        )
        }

        function changeToGrid(container, columns) {
            container.css({display: "grid", grid: `auto-flow / repeat(${columns}, 1fr)`})
        }
    
        function createNavItem(data) {
            return jQuery(`
<li class="nav-item" role="presentation">
    <button class="nav-link" id="pills-${data.target}-tab" data-bs-toggle="pill" data-bs-target="#pills-${data.target}" type="button"
            role="tab" aria-controls="pills-${data.target}" aria-selected="false">
        ${data.title}
    </button>
</li>
`                        )
        }
        
        const data = [{target: 'aaaaaaa', title: 'aaa', content: 'AAAAA'},
                      {target: 'bbbbbbb', title: 'bbb', content: 'BBBBB'},
                      {target: 'bbccccc', title: 'ccc', content: 'CCCCC'}]

        function doTabs(tabsId, navsId, data) {
            const tabs = jQuery(tabsId)
            const navs = jQuery(navsId)
            changeToGrid(navs, 2)
            data.forEach(datum => {
                tabs.append(createTabPane(datum))
                navs.append(createNavItem(datum))
            })
        }

        doTabs("#pills-tabContent", "#pills-tab", data)

        function doChildren($parent, children) {
            children.forEach(x => {
                if (!Array.isArray(x.data)) {
                    x.data = [x.data]
                }
                const ids = []
                x.data.forEach(y => {
                    $elem = x.element(x.name, y, x.selected, ids)
                    if ($elem) {
                        $parent.append($elem)
                    }
                })
                console.log("ids=", ids)
            })
        }

        function navContainer(data) {
            const id = `pills-tab-${data.name}`
            let $container = jQuery(`#${id}`)
            const exists = $container.length > 0
            if (!exists) {
                $container = jQuery(`
<ul class="nav nav-pills mb-3" id="" role="tablist"
        style="display: grid; grid: auto-flow / repeat(${data.columns}, 1fr); width: 225px; border: 3px solid blue; box-sizing: border-box; overflow: hidden;">
</ul>
`)
            }
            if (data === prevData.get(id)) {
                return null
            }
            prevData.set(id, data)
            const children = [
                {element: navItem, name: data.name, data: data.items, selected: data.selected}
            ]
            doChildren($container, children)
            return exists ? null : $container            
        }

        function navItem(name, data, selected, ids = null) {
            const id = `pills-${name}-${data.target}-tab`
            if (Array.isArray(ids)) {
                ids.push(id)
            }
            let $item = jQuery(`#${id}`)
            const exists = $item.length > 0
            if (!exists) {
                $item = jQuery(`
<li class="nav-item" role="presentation">
    <button class="nav-link" id="${id}" data-bs-toggle="pill" data-target="#pills-${name}-${data.target}"
            type="button" role="tab" aria-controls="pills-${name}-${data.target}" aria-selected="false">
        ${data.title}
    </button>
</li>
`)
            } else {
                $item = $item.parent()
            }
            const $button = $item.find("button")
            if (data.target === selected) {
                $button.addClass("active")
                $button.attr("aria-current", "page")
            } else {
                $button.removeClass("active")
                $button.removeAttr("aria-current")
            }
            return exists ? null : $item
        }

        function tabContainer(data) {
            const id = `pills-tabContent-${data.name}`
            let $container = jQuery(`#${id}`)
            const exists = $container.length > 0
            if (!exists) {
                $container = jQuery(`<div class="tab-content" id="${id}" style="aspect-ratio: 1 / 1; border: 3px solid green; box-sizing: border-box;" />`)
            }
            if (data === prevData.get(id)) {
                return null
            }
            prevData.set(id, data)
            const children = [
                {element: tab, name: data.name, data: data.items, selected: data.selected}
            ]
            doChildren($container, children)
            return exists ? null : $container
        }
    
        function tab(name, data, selected, ids) {
            const id = `pills-${name}-${data.target}`
            let $tab = jQuery(`#${id}`)
            const exists = $tab.length > 0
            if (!exists) {
                $tab = jQuery(`
<div class="tab-pane fade" id="${id}" role="tabpanel" aria-labelledby="pills-${name}-${data.target}-tab">
The content of id="${name}-${data.target}" from tab="${data.title}" is "${data.content}".
</div>
`)
                if (Array.isArray(ids)) {
                    ids.push(id)
                }
            }
            if (data.target === selected) {
                $tab.addClass(["active", "show"])
            } else {
                $tab.removeClass(["active", "show"])
            }
            return exists ? null : $tab
        }
        
        function option(name, data, selected, ids) {
            const id = `${name}-${data.target}`
            let $option = jQuery(`#${id}`)
            const exists = $option.length > 0
            if (!exists) {
                $option = jQuery(`<option value="${id}">${name}:${data.title}</option>`)
                if (Array.isArray(ids)) {
                    ids.push(id)
                }
            }
            return exists ? null : $option
        }

        function chooserContainer(name, data, selected, ids) {
            const id = `chooser-${data.name}`
            let $container = jQuery(`#${id}`)
            const exists = $container.length > 0
            if (!exists) {
                $container = jQuery(`<div id="${id}" style="border:2px solid magenta;" />`)
                $container.append(tabContainer(data)).append(navContainer(data))
            } else {
                if (data === prevData.get(id)) {
                    return null
                }
                prevData.set(id, data)
                tabContainer(data)
                navContainer(data)
            }
            return exists ? null : $container
        }

        function choosersContainer(data) {
            const id = "choosers"
            let $container = jQuery(`#${id}`)
            const exists = $container.length > 0
            if (!exists) {
                $container = jQuery(`<div id="${id}" style="display: grid; grid-template-columns: repeat(2, 1fr);border:2px solid black;" />`)
            }
            if (data === prevData.get(id)) {
                return null
            }
            const children = [
                {element: chooserContainer, name: null, data: data, selected: null}
            ]
            doChildren($container, children)
            return $container
        }
        
        function selectorContainer(data) {
            const id = `selector-${data.name}`
            let $container = jQuery(`#${id}`)
            const exists = $container.length > 0
            if (!exists) {
                $container = jQuery(`<select id="${id}" class="form-select" aria-label="Default select example" />`)
                const children = [
                    {element: option, name: data.name, data: data.items, selected: data.selected}
                ]
                doChildren($container, children)
            }
            if (data === prevData.get(id)) {
                return null
            }
            prevData.set(id, data)
            $container.val(`${data.name}-${data.selected}`)
            return exists ? null : $container
        }

        function description(name, data, selected, ids) {
            const id = `description-${name}-${data.target}`
            let $desc = jQuery(`#${id}`)
            const exists = $desc.length > 0
            if (!exists) {
                $desc = jQuery(`
<div class="tab-pane fade" id="${id}" role="tabpanel" aria-labelledby="description-${name}-${data.target}-tab"
        style="aspect-ratio: 3 / 1; color: red; font-size: 0.7rem; font-weight: bold;">
The content of id="${name}-${data.target}" from tab="${data.title}" is "${data.content}".
</div>
`)
                if (Array.isArray(ids)) {
                    ids.push(id)
                }
            }
            if (data.target === selected) {
                $desc.addClass(["active", "show"])
            } else {
                $desc.removeClass(["active", "show"])
            }
            return exists ? null : $desc
        }

        function selectorDescriptionContainer(data) {
            const id = `selector-description-${data.name}`
            let $container = jQuery(`#${id}`)
            const exists = $container.length > 0
            if (!exists) {
                $container = jQuery(`<div class="tab-content" id="${id}" style="border: 3px solid blue; box-sizing: border-box;" />`)
            }
            if (data === prevData.get(id)) {
                return null
            }
            prevData.set(id, data)
            const children = [
                {element: description, name: data.name, data: data.items, selected: data.selected}
            ]
            doChildren($container, children)
            return exists ? null : $container
        }   
        function selectorsContainer(data) {
            const id = "selectors"
            let $container = jQuery(`${id}`)
            const exists = $container.length > 0
            if (!exists) {
                $container = jQuery(`<div id="${id}" style="border:2px solid black;" />`)
                data.forEach(datum => {
                    $container.append(selectorContainer(datum))
                    $container.append(selectorDescriptionContainer(datum))
                })
            } else {
                if (data === prevData.get(id)) {
                    return null
                }
                prevData.set(id, data)
                data.forEach(datum => {
                    selectorContainer(datum)
                    selectorDescriptionContainer(datum)
                })
            }
            return exists ? null : $container
        }
        function choosersSelectorsContainer(data) {
            const id = "choosers-selectors"
            let $container = jQuery(`#${id}`)
            const exists = $container.length > 0
            if (!exists) {
                $container = jQuery(`<div id="${id}" style="display: grid; grid-template-columns: 1fr 1fr 2fr ;border:2px solid cyan;" />`)
                $container.append(choosersContainer(data)).append(selectorsContainer(data))
            } else {
                if (data === prevData.get(id)) {
                    return null
                }
                prevData.set(id, data)
                choosersContainer(data)
                selectorsContainer(data)
            }
            return exists ? null : $container
         }
        
        let choosersData = [
            {
                name: "alpha",
                columns: 3,
                items:   [{target: 'aaaaa', title: 'aaa', content: 'AAAAAAA'},
                          {target: 'bbbbb', title: 'bbb', content: 'BBBBBBB'},
                          {target: 'ccccc', title: 'ccc', content: 'CCCCCCC'},
                          {target: 'ddddd', title: 'ddd', content: 'DDDDDDD'},
                          {target: 'eeeee', title: 'eee', content: 'EEEEEEE'},
                          {target: 'fffff', title: 'fff', content: 'FFFFFFF'}],
                selected: 'aaaaa'
            },
            {
                name: "beta",
                columns: 3,
                items:   [{target: 'aaaaa', title: 'aaa', content: 'AAAAAAA'},
                          {target: 'bbbbb', title: 'bbb', content: 'BBBBBBB'},
                          {target: 'ccccc', title: 'ccc', content: 'CCCCCCC'},
                          {target: 'ddddd', title: 'ddd', content: 'DDDDDDD'},
                          {target: 'eeeee', title: 'eee', content: 'EEEEEEE'},
                          {target: 'fffff', title: 'fff', content: 'FFFFFFF'}],
                selected: 'ddddd'
            },
            {
                name: "gamma",
                columns: 3,
                items:   [{target: 'aaaaa', title: 'aaa', content: 'AAAAAAA'},
                          {target: 'bbbbb', title: 'bbb', content: 'BBBBBBB'},
                          {target: 'ccccc', title: 'ccc', content: 'CCCCCCC'},
                          {target: 'ddddd', title: 'ddd', content: 'DDDDDDD'},
                          {target: 'eeeee', title: 'eee', content: 'EEEEEEE'},
                          {target: 'fffff', title: 'fff', content: 'FFFFFFF'}],
                selected: 'fffff'
            }
        ]
        const prevData = new Map()
        jQuery("#nav-root").append(choosersSelectorsContainer(choosersData))
        
        document.addEventListener("click", e => {console.log("click: ", e)}, true)
        document.addEventListener("shown.bs.tab", e => {
            console.log("document::shown.bs.tab:e=", e)
            const keys = e.target.dataset.target.match(/#pills-(\w+)-(\w+)/)
            console.log("keys=", keys)
            const tab = document.getElementById(e.target.dataset.target.substring(1))
            console.log("tab=", tab)
            // jQuery(`#selector-${keys[1]}`).val(`${keys[1]}-${keys[2]}`)
            choosersData = [...choosersData]
            const i = choosersData.findIndex(x => x.name === keys[1])
            choosersData[i] = {...choosersData[i], selected: keys[2]}
            choosersSelectorsContainer(choosersData)
        }, true)
        jQuery("button.nav-link").on("shown.bs.tab", e => {
            console.log("jQuery::shown.bs.tab:e=", e)            
        })
        jQuery("select.form-select").on("change", e => {
            console.log("select.form-select:e=", e)   
            const targetVal = jQuery(e.target).val()         
            console.log("select.form-select:targetVal=", targetVal)
            const keys = jQuery(e.target).val().match(/(\w+)-(\w+)/)
            console.log("keys=", keys)
            // jQuery(`#pills-${keys[1]}-${keys[2]}-tab`).click()
            choosersData = [...choosersData]
            const i = choosersData.findIndex(x => x.name === keys[1])
            choosersData[i] = {...choosersData[i], selected: keys[2]}
            choosersSelectorsContainer(choosersData)
        })
    </script>
  </body>
</html>
